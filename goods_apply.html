<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>提货申请</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"/>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/goods_apply.css" />
    <link rel="stylesheet" href="css/zepto.mdatetimer.css" />
    <link rel="stylesheet" type="text/css" href="css/jedate.css">

    <script type="text/javascript" src="js/selfFit.js" ></script>
    <script type="text/javascript" src="js/main.js" ></script>
    <script type="text/javascript" src="js/jquery-3.2.1.min.js" ></script>
    <script type="text/javascript" src="js/angular-1.3.10.min.js" ></script>
    <script type="text/javascript" src="js/jquery.jedate.min.js"></script>

    <style>
        #recordDetail .jeinpbox{
            float: left;
            width: 3rem;
            margin-right: 0px;
            display: inline-block;
            vertical-align: middle;
            position: relative;
        }
        #recordDetail .jeinput {
            display: block;
            width: 100%;
            padding-left: 0.03rem;
            height: 0.59rem;
            line-height: .45rem;
            border: 1px solid #e6e6e6;
            background-color: #fff;
            border-radius: 3px;
        }
        #recordDetail .jebtns {
            width: .5rem;
            margin-left: 3px;
            height: .65rem;
            line-height: 1;
            background-color: #fff;
            border-radius: 3px;
            background-position: right center;
            float: left;
            cursor: pointer;
        }
        #recordDetail .icons {
            background: url("images/date.png") no-repeat;
            background-size: 100% 100%;
        }
        .warehouse-search{
            position: relative;
            float: right;
            right: 0.2rem;
            width: 3.55rem;
            height: 0.62rem;
            line-height: 0.62rem;
            background: #f3f5fe;
            border-radius: 0.1rem;
            overflow: hidden;
        }

        .warehouse-search>select{
            width: 100%;
            padding: 0 0.1rem;
            background: #f3f5fe;
            height: 0.62rem;
            outline: none;
            border: none;
            text-align-last: center;
        }

        .warehouse-search>select>option{
            text-align: center;
            text-align-last: center;
        }
    </style>
</head>
<body ng-app="goodApplyModules" ng-controller="goodApplyCtrls">
<div id="header" class="header" style="display: none;">
    <div id="return_key" class="return-key">
        <div id="back-img"></div>&nbsp;<span>返回</span>
    </div>
    <span class="title">提货申请</span>
    <hr color="#E5E5E5"/>
</div>

<div id="recordDetail" style="position: relative;top: .5rem;" ng-cloak="">
    <div class="headerContent" ng-cloak="">
        <table>
            <tr>
                <td class="left">交货仓库</td>
                <td class="right">{{record.storeHouseName}}</td>
            </tr>
            <tr>
                <td colspan="3" style="text-align: center">{{record.storeHouseAddress}}</td>
            </tr>
        </table>
    </div>
    <div class="middleContent">
        <table>
            <tr>
                <td class="left">PID</td>
                <td class="right"><p>{{record.pid}}</p></td>
            </tr>
            <tr>
                <td class="left">商品名称</td>
                <td class="right">{{record.productName}}</td>
            </tr>
            <tr>
                <td class="left">批号</td>
                <td class="right">{{record.batchNum}}</td>
            </tr>
            <tr>
                <td class="left">库存件数</td>
                <td class="right"><p>{{record.storeJianshu}}</p></td>
            </tr>
            <tr>
                <td class="left">库存重量（吨）</td>
                <td class="right">{{record.storeWeight}}</td>
            </tr>
            <tr>
                <td class="left">包装规格</td>
                <td class="right">{{record.packingSpecification}}</td>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货件数</td>
                <td class="right input"><input type="text" class="input" ng-model="itemNumber"></td>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货重量（吨）</td>
                <td class="right input"><input type="text" class="input" ng-model="weight"></td>
            </tr>
            <tr>
                <td class="left">回款单价（元/吨）</td>
                <td class="right">{{list.repaymentUnitPrice}}</td>
            </tr>
            <tr>
                <td class="left">应回贷款金额（元）</td>
                <td class="right">{{list.needBackGoodsMoney}}</td>
            </tr>
            <tr>
                <td class="left">保证金释放金额（元）</td>
                <td class="right">{{list.releaseBond}}</td>
            </tr>
            </tr>
            <tr>
                <td class="left">应付金额（元）</td>
                <td class="right">{{list.money}}</td>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货人姓名</td>
                <td class="right input"><input type="text" class="input" ng-model="name"></td>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货人身份证</td>
                <td class="right input"><input type="text" class="input" ng-model="idCard"></td>
            </tr>
            <tr>
                <td class="left">提货人手机号</td>
                <td class="right">{{list.telephone}}</td>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货日期</td>
                <td class="right">
                    <div class="rightinput">
                        <div class="jewarp jeitem" onclick="dateSelect(this)" >
                            <div class="jeinpbox" style="width: 80%;">
                                <input type="text" class="jeinput" id="testico" readonly>
                            </div>
                            <div class="icons jebtns" ></div>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="left">提货方式</td>
                <td class="right">
                    <div class="warehouse-search">
                        <select id="warehouse-options">
                            <option value="" ng-repeat="node in list">{{node.storeHouseName}}</option>
                        </select>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货车牌号</td>
                <td class="right input"><input type="text" class="input" ng-model="carNumber"></td>
            </tr>
        </table>
    </div>
    <div class="footContent">
        <button ng-click="submit()">提交</button>
    </div>
</div>
    <script type="text/javascript">
        var _url;
        var goods;

        $(function(){

        });

        //日期控制
        function dateSelect(inputobj){
            var a = $(inputobj);
            $.jeDate(a.find("#testico"),{trigger:false,format: 'YYYY-MM-DD'})
        }

        angular.module('goodApplyModules', []).controller('goodApplyCtrls', ['$scope', '$http', function($scope, $http) {
            _url = getURLParams();
            goods = decodeURIComponent(_url.goods);
            console.log("goods==>"+JSON.stringify(goods))
            $http({method: 'POST', url: remote_url,goods}).then(function(rep) {
                if(rep.status==200){
                    $scope.detail = rep.data.content
                }
            })

                    $scope.submit=function(){
                        var params={
                            fromType:urlParams.fromType,
                            mobile:urlParams.mobile,
                            _vt:urlParams._vt,
                            loc:urlParams.loc,
                            versionID:urlParams.versionID,
                            loginId:urlParams.loginId,
                            mtn:urlParams.mtn,
                            buildID:urlParams.buildID,
                            _svt:urlParams._svt,
                            orderstatus:1,  //订单类型（应该需要传值判断）
                            calType:1,//计算类型 1：件数 2:重量
                            storeHouseId:'',//仓库id
                            batchNum:'',//批号
                            repaymentUnitprice:'',//
                            orderId:'',//订单id
                            productId:productId,//商品id
                            thjianshu:'',//提货件数
                            thweight:''//提货重量
                        }

                        $http({method: 'POST', url: remote_url,params}).then(function(rep) {
                            var content=rep.data.content
                            var data={
                                "itemNumber":$scope.itemNumber,
                                "weight":$scope.weight,
                                "name":$scope.name,
                                "idcard":$scope.idCard,
                                "time":$scope.time,
                                "carnumber":$scope.carNumber,
                                "pid":"仓单号",
                                "orderId":'',
                                "productId":"商品id",
                                "storeHouseId":"仓库id",
                                "productOwnerId":'',
                                "batchNum":"批号",
                                "packing_specification":"包装规格",
                                "warehousingFeeJson":{
                                    "repaymentBalance":content.repaymentBalance,
                                    "goodsBack":content.goodsBack
                                },
                                "ladingListId":"",//应付金额"(代购 代开 代销)
                                "repaymentUnitprice":'',//回款单价,(代购 代开 代销)
                                 "money":''//应付金额"(代购 代开 代销)
                            }
                            $http({method: 'POST', url: "https://wei.wiyarn.com/actiz/rs/b",data}).then(function(rep) {

                            })
                        })

                    }


                }])

        $("#return_key").click(function () {
            back();
        });
    </script>
</div>
</body>
</html>