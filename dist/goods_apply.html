<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>提货申请</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"/>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/goods_apply.css" />
    <script type="text/javascript" src="../dist/js/selfFit.js" ></script>
    <script type="text/javascript" src="../dist/js/jquery-3.2.1.min.js" ></script>
    <script type="text/javascript" src="../dist/js/angular-1.3.10.min.js" ></script>
    <script type="text/javascript" src="../dist/js/main.js" ></script>
    <link rel="stylesheet" href="../dist/css/zepto.mdatetimer.css" />
    <style>
        #recordDetail .jeinpbox{
            float: left;
            width: 3rem;
            margin-right: 0px;
            display: inline-block;
            vertical-align: middle;
            position: relative;
        }
        #recordDetail .jeinput {
            display: block;
            width: 100%;
            padding-left: 0.03rem;
            height: 0.59rem;
            line-height: .45rem;
            border: 1px solid #e6e6e6;
            background-color: #fff;
            border-radius: 3px;
        }
        #recordDetail .jebtns {
            width: .5rem;
            margin-left: 3px;
            height: .65rem;
            line-height: 1;
            background-color: #fff;
            border-radius: 3px;
            background-position: right center;
            float: left;
            cursor: pointer;
        }
        #recordDetail .icons {
            background: url("images/date.png") no-repeat;
            background-size: 100% 100%;
        }
        .warehouse-search{
            position: relative;
            float: right;
            right: 0.2rem;
            width: 3.55rem;
            height: 0.62rem;
            line-height: 0.62rem;
            background: #f3f5fe;
            border-radius: 0.1rem;
            overflow: hidden;
        }

        .warehouse-search>select{
            width: 100%;
            padding: 0 0.1rem;
            background: #f3f5fe;
            height: 0.62rem;
            outline: none;
            border: none;
            text-align-last: center;
        }

        .warehouse-search>select>option{
            text-align: center;
            text-align-last: center;
        }
    </style>
    <script type="text/javascript" src="../dist/js/jquery.jedate.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../dist/css/jedate.css">
</head>
<body ng-app="goodApplyModules" ng-controller="goodApplyCtrls">
<div id="header" class="header">
    <div id="return_key" class="return-key">
        <div id="back-img"></div>&nbsp;<span>返回</span>
    </div>
    <span class="title">提货申请</span>
    <hr color="#E5E5E5"/>
</div>

<div id="recordDetail">
    <div class="headerContent" ng-cloak="">
        <table>
            <tr>
                <td class="left">交货仓库</td>
                <td class="right">
                    <select id="warehouses"></select>
                </td>
            </tr>
            <tr>
                <td colspan="3" style="text-align: center"><span id="storeHouseAddress"></span></td>
            </tr>
        </table>
    </div>
    <div class="middleContent">
        <table>
            <tr>
                <td class="left">商品类型</td>
                <td class="right"><select id="goodsTypesOptions"></select>&nbsp;&nbsp;<select id="goodsOptions"></select></td>
            </tr>
            <tr>
                <td class="left">批号</td>
                <td class="right"><input type="text" class="input" ng-model="batchNumber"></td>
            </tr>
            <tr>
                <td class="left">包装</td>
                <td class="right"><input type="text" class="input" ng-model="packaging"></td>
            </tr>
            <tr>
                <td class="left">产地</td>
                <td class="right"><input type="text" class="input" ng-model="origin"></td>
            </tr>
            <tr>
                <td class="left">重量（吨）</td>
                <td class="right"><input type="text" class="input" ng-model="weight"></td>
            </tr>
            <tr>
                <td class="left">件数</td>
                <td class="right input"><input type="text" class="input" ng-model="itemNumber"></td>
            </tr>
            <tr>
                <td class="left">入库时间</td>
                <td class="right input">
                    <div class="rightinput">
                        <div class="jewarp jeitem" onclick="dateSelect(this)">
                            <div class="jeinpbox" style="width: 80%;">
                                <input type="text" class="jeinput" id="testico" readonly ng-model="inboundDate">
                            </div>
                            <div class="icons jebtns"></div>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="left">车号</td>
                <td class="right"><input type="text" class="input" ng-model="carNumber"></td>
            </tr>
            <tr>
                <td class="left">司机名称</td>
                <td class="right"><input type="text" class="input" ng-model="driverName"></td>
            </tr>
            <tr>
                <td class="left">司机号码</td>
                <td class="right"><input type="text" class="input" ng-model="driverPhone"></td>
            </tr>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货重量（吨）</td>
                <td class="right input"><input type="text" class="input" ng-model="weight"></td>
            </tr>
            <tr ng-hide="{{item.orderstatus==4}}">
                <td class="left">回款单价（元/吨）</td>
                <td class="right">{{list.repaymentUnitPrice}}</td>
            </tr>
            <tr ng-hide="{{item.orderstatus==4}}">
                <td class="left">应回贷款金额（元）</td>
                <td class="right">{{list.needBackGoodsMoney}}</td>
            </tr>
            <tr ng-hide="{{item.orderstatus==4}}">
                <td class="left">保证金释放金额（元）</td>
                <td class="right">{{list.releaseBond}}</td>
            </tr>
            <tr ng-hide="{{item.orderstatus==4}}">
                <td class="left">应付金额（元）</td>
                <td class="right">{{list.money}}</td>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货人姓名</td>
                <td class="right input"><input type="text" class="input" ng-model="name"></td>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货人身份证</td>
                <td class="right input"><input type="text" class="input" ng-model="idCard"></td>
            </tr>
            <tr>
                <td class="left">提货人手机号</td>
                <td class="right">{{list.telephone}}</td>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货日期</td>
                <td class="right">
                    <div class="rightinput">
                        <div class="jewarp jeitem" onclick="dateSelect(this)" >
                            <div class="jeinpbox" style="width: 80%;">
                                <input type="text" class="jeinput" id="testico" readonly>
                            </div>
                            <div class="icons jebtns" ></div>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="left">提货方式</td>
                <td class="right">
                    <div class="warehouse-search">
                        <select id="warehouse-options">
                            <option value="" ng-repeat="node in list">{{node.storeHouseName}}</option>
                        </select>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="left"><span>*&nbsp;</span>提货车牌号</td>
                <td class="right input"><input type="text" class="input" ng-model="carNumber"></td>
            </tr>
        </table>
    </div>
    <div class="footContent">
        <button ng-click="submit()">提交</button>
    </div>
</div>
    <script type="text/javascript">
        //日期控制
        function dateSelect(inputobj){
            var a = $(inputobj);
            $.jeDate(a.find("#testico"),{trigger:false,format: 'YYYY-MM-DD'})
        }

        var urlParam=getURLParams();
        $(function(){
            //加载全部仓库
            loadWarehouses();
            $("#storeHouseAddress").html(decodeURI(urlParam.storeHouseAddress));
        });


        angular.module('goodApplyModules', [])
                .controller('goodApplyCtrls', ['$scope', '$http', function($scope, $http) {
                    $scope.submit=function(){
                        var params={
                            fromType:2,
                            mobile:'true',
                            loginId:'ur4qqtjxnm',
                            mtn:'a210213a55154d08a24275cd2d890406',
                            buildID:'201608071700',
                            loc:'zh-Hans',
                            versionID:'1.0.0',
                            _svt:'',
                            orderstatus:1,  //订单类型（应该需要传值判断）
                            calType:1,//计算类型 1：件数 2:重量
                            storeHouseId:'',//仓库id
                            batchNum:'',//批号
                            repaymentUnitprice:'',//
                            orderId:'',//订单id
                            productId:productId,//商品id
                            thjianshu:'',//提货件数
                            thweight:''//提货重量
                        }


                        $http({method: 'POST', url: "https://wei.wiyarn.com/actiz/rs/b",params}).then(function(rep) {
                            var content=rep.data.content
                            var data={
                                "itemNumber":$scope.itemNumber,
                                "weight":$scope.weight,
                                "name":$scope.name,
                                "idcard":$scope.idCard,
                                "time":$scope.time,
                                "carnumber":$scope.carNumber,
                                "pid":"仓单号",
                                "orderId":'',
                                "productId":"商品id",
                                "storeHouseId":"仓库id",
                                "productOwnerId":'',
                                "batchNum":"批号",
                                "packing_specification":"包装规格",
                                "warehousingFeeJson":{
                                    "repaymentBalance":content.repaymentBalance,
                                    "goodsBack":content.goodsBack
                                },
                                "ladingListId":"",//应付金额"(代购 代开 代销)
                                "repaymentUnitprice":'',//回款单价,(代购 代开 代销)
                                 "money":''//应付金额"(代购 代开 代销)
                            }
                            $http({method: 'POST', url: "https://wei.wiyarn.com/actiz/rs/b",data}).then(function(rep) {

                            })

                        })
                    }
                }])

        //加载全部仓库
        function loadWarehouses() {
            //获取仓库列表——初始
            $.ajax({
                type:"post",
                url:remote_url,
                async:true,
                data:{
                    fromType:2,
                    mobile:true,
                    loc:"zh-Hans",
                    versionID:"1.0.0",
                    _m:"listStorageHosue",
                    _s:"coop",
                    loginId: "ur4qqtjxnm",
                    mtn: "a210213a55154d08a24275cd2d890406"
                },
                success:function(rep){
                    var reps = JSON.parse(rep);
                    if(reps.result){
                        var str = '<li data-id="0"><div class="warehouse-option"></div>全部仓库</li>',
                            list = reps.content;
                        for(var i=0;i<list.length;i++){
                            str += '<option data-id="'+list[i].storeHouseId +'">'+list[i].storeHouseName+'</option>'
//                        str += '<li data-id="'+ list[i].storeHouseId +'"><div class="warehouse-option">'+ list[i].storeHouseName +'</div></li>'
                        };
                        $('#warehouses').append(str);
                    }
                }

            });
        }


        $("#return_key").click(function () {
            back();
        });
    </script>
</div>
</body>
</html>